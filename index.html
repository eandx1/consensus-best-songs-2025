<!DOCTYPE html>
<html lang="en" data-theme="dark" data-style="original">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Consensus Best Songs 2025</title>
    <meta
      name="description"
      content="The definitive consensus ranking of 2025's best music."
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
    />

    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@justinribeiro/lite-youtube@1/lite-youtube.js"
    ></script>

    <style>
      /* 
           THEME CONFIGURATION
           We use data-theme for Pico's base (light/dark) and data-style for specific color palettes/fonts.
           
           To add a new theme:
           1. Define a new [data-style="theme-name"] block here with your overrides.
              - --pico-primary: Main accent color
              - --pico-primary-background: Background for buttons/badges
              - --pico-primary-hover: Hover state color
              - --pico-primary-underline: Underline color
              - --pico-font-family: Optional font override (default is sans-serif)
           2. Update the `themes` object in script.js `applyTheme()` function.
           3. Add the option to the Theme Selector in script.js `renderSettingsUI()`.
        */

      /* Base Settings (Global) */
      :root {
        /* Mobile-first: Increase base size for better legibility by default */
        --pico-font-size: 115%;
      }

      /* THEME: Original (Blue Accent) */
      [data-style="original"] {
        /* High-vibrancy Azure */
        --pico-primary: #60a5fa;
        --pico-primary-background: #3b82f6;
        --pico-primary-hover: #93c5fd;
        --pico-primary-underline: rgba(96, 165, 250, 0.5);

        /* Brighten secondary text for better reading */
        --pico-muted-color: #94a3b8;
      }

      /* 
           FUTURE THEME EXAMPLES:
           
           [data-style="crimson"] {
               --pico-primary: #c62828;
               --pico-primary-background: #c62828;
               --pico-primary-hover: #b71c1c;
               --pico-primary-underline: rgba(198, 40, 40, 0.5);
               --pico-font-family: "Georgia", "Times New Roman", serif; 
           }
        */

      /* Enable word-wrapping for Pico CSS tooltips */
      [data-tooltip]::before {
        display: block;
        white-space: normal; /* Allows text to wrap to the next line */
        width: 280px; /* Sets a maximum width for the box */
        max-width: 80vw; /* Ensures it doesn't exceed the viewport on mobile */
        line-height: 1.4; /* Improves readability for multi-line text */
        padding: 0.5rem 0.75rem;
      }

      /* Fix for mobile modal scrolling clipping */
      dialog > article {
        max-height: calc(100dvh - var(--pico-spacing) * 2);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch; /* Ensures smooth momentum scrolling on iOS */
      }

      /* Add spacing at the top of the main container for rank #1 */
      main.container {
        padding-top: var(--pico-block-spacing-vertical);

        /* Mobile: Reduce side padding so cards are wider */
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }

      /* Desktop: Allow container to be wider for more breathing room */
      @media (min-width: 1025px) {
        main.container,
        header.container {
          max-width: 90vw; /* Use more screen real estate */
        }
      }

      @media (min-width: 1400px) {
        main.container,
        header.container {
          max-width: 1300px; /* Cap it reasonably on huge screens */
        }
      }

      /* Add space for the iPhone's "notch" and address bar on mobile by default */
      main#app {
        padding-top: 2rem;
      }

      /* Song Cards: Minimal custom styling, rely on Pico's article styling */
      article.song-card {
        position: relative;
        margin-bottom: 2rem;
      }

      /* 
           MOBILE-FIRST LAYOUT 
           Base styles apply to mobile (and up, unless overridden).
        */

      .song-card-layout {
        display: flex;
        flex-direction: column; /* Stack vertically on mobile */
        align-items: flex-start;
        gap: var(--pico-spacing);
      }

      .rank-display {
        flex: 0 0 auto;
        text-align: left;
        font-size: 2.5rem; /* Bigger rank on mobile */
        font-weight: 900;
        opacity: 0.6;
        line-height: 1;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        margin-bottom: -1rem; /* Pull video up closer to rank */
      }

      .video-figure {
        flex: 0 0 auto;
        width: 100%; /* Full width on mobile */
        margin: 0;
      }

      .song-info {
        flex: 1;
        min-width: 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        width: 100%; /* Ensure it takes full width in stack */
      }

      .about-methodology-box {
        background: var(--pico-card-background-color);
        padding: var(--pico-spacing);
        border-radius: var(--pico-border-radius);
        border: 1px solid var(--pico-muted-border-color);
      }

      /* Video player wrapper using semantic <figure> */
      article.song-card figure {
        margin: 0;
        display: flex;
        align-items: center;
      }

      article.song-card figure lite-youtube {
        width: 100%;
        aspect-ratio: 16 / 9;
        border-radius: var(--pico-border-radius);
        border: 1px solid var(--pico-muted-border-color);
      }

      /* Customize lite-youtube play button - Mobile Default (visible) */
      lite-youtube::part(playButton) {
        width: 68px;
        height: 48px;
        background-color: transparent;
        filter: grayscale(1);
        opacity: 0.15; /* Mobile default - slightly visible */
        transition: opacity 0.2s, filter 0.2s;
      }

      /* Header contains hgroup and info icon */
      article.song-card .song-info > header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 1rem;
        padding: 0;
        margin: 0;
        margin-bottom: 0.75rem;
        border: none;
      }

      article.song-card hgroup {
        margin-bottom: 0;
        flex: 1;
      }

      /* Song Title - Mobile optimized */
      article.song-card hgroup h3 {
        /* font-size: 1.5rem; /* Larger, clearer title */
        margin-bottom: 0.25rem;
        line-height: 1.2;
        color: var(--pico-color);

        font-weight: 800; /* Extra bold for visibility */
      }

      /* Use h4 for artist name in hgroup */
      article.song-card hgroup h4 {
        margin-bottom: 0;
        color: var(--pico-muted-color);
        font-weight: normal;
      }

      /* Info icon - now inside header, aligned to baseline */
      article.song-card header > a[aria-label] {
        opacity: 0.4;
        font-size: 1.4rem; /* Slightly larger touch target */
        transition: opacity 0.2s;
        padding: 0.25rem;
        margin: -0.25rem 0 0 0; /* Compensation for padding */
        text-decoration: none;
        flex-shrink: 0;
      }

      article.song-card header > a[aria-label]:hover {
        opacity: 1;
      }

      /* Sources section styling - Mobile optimized */
      article.song-card [data-sources] {
        margin: 0.75rem 0;
        line-height: 1.6; /* Tightened from 2, but still touch-friendly */
        font-size: 1rem; /* Increased from 0.95rem */
        cursor: pointer;
      }

      article.song-card [data-sources] span {
        white-space: nowrap;
        color: var(--pico-muted-color);
        font-size: 0.8rem;
        transition: color 0.2s;
      }

      article.song-card:hover [data-sources] span {
        color: var(--pico-color);
      }

      /* Nav for listen links - Pico handles most styling */
      article.song-card nav {
        margin-top: auto;
        padding: 0;
      }

      article.song-card nav ul {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin: 0;
        padding: 0;
        list-style: none;
      }

      article.song-card nav li {
        margin: 0;
        padding: 0;
      }

      article.song-card nav a {
        font-size: 0.85rem; /* Increased from 0.7rem */
        text-transform: uppercase;
        font-weight: 700;
        opacity: 0.7;
        transition: opacity 0.2s;
        padding: 0.4rem 0.5rem; /* Larger touch targets */
        text-decoration: none;
      }

      article.song-card nav a:hover {
        opacity: 1;
      }

      /* 
           DESKTOP / TABLET OVERRIDES 
           Apply when screen width is >= 577px
        */
      @media (min-width: 1025px) {
        :root {
          --pico-font-size: 100%; /* Reset to standard size on desktop */
        }

        main#app {
          padding-top: 0; /* Remove extra top padding */
        }

        .song-card-layout {
          flex-direction: row; /* Horizontal layout */
          align-items: center;
        }

        .rank-display {
          flex: 0 0 4rem; /* Fixed width */
          text-align: center;
          font-size: clamp(1.75rem, 2.5vw, 2.25rem);
          margin-bottom: 0;
          justify-content: center;
        }

        .video-figure {
          flex: 0 0 320px; /* Fixed width for video */
          width: auto;
        }

        /* Tighter line height for mouse users */
        article.song-card [data-sources] {
          line-height: 1.8;
          font-size: 0.875rem;
        }
      }

      /* Large Desktop Overrides */
      @media (min-width: 1200px) {
        .video-figure {
          flex: 0 0 360px;
        }
      }

      /* Hover effects for devices that support it (mostly desktop) */
      @media (hover: hover) {
        lite-youtube::part(playButton) {
          opacity: 0; /* Invisible until hover or focus */
        }

        lite-youtube:hover::part(playButton),
        lite-youtube:focus::part(playButton),
        lite-youtube:focus-within::part(playButton) {
          opacity: 1;
        }
      }

      /* Responsive Header - Two-Column Flex Layout */
      header.container nav {
        display: flex;
        justify-content: space-between;
        align-items: flex-start; /* Title starts at top, but links stay level */
        flex-wrap: nowrap;
      }

      /* The Title Block */
      header.container nav ul:first-of-type {
        flex: 1;
        display: block; /* Allow the <strong> to wrap naturally */
        padding: 0;
      }

      header.container nav ul:first-of-type li {
        display: block;
        padding: 0;
      }

      header.container nav ul:first-of-type li strong {
        display: block;
        line-height: 1.1;
        font-size: clamp(1rem, 4.5vw, 1.3rem);
        white-space: normal; /* This enables the wrap you want */
        max-width: 180px; /* Forces 'Consensus' and 'Best Songs' to stack */
      }

      /* Desktop: Unwrap title and align items vertically */
      @media (min-width: 1025px) {
        header.container nav {
          align-items: center;
        }

        header.container nav ul:first-of-type li strong {
          max-width: none;
          white-space: nowrap;
        }
      }

      /* The Links Block */
      header.container nav ul:last-of-type {
        display: flex;
        align-items: center; /* Keep 'Settings' and 'About' perfectly level */
        height: 2.2rem; /* Matches the height of the first line of text */
        flex-shrink: 0;
      }

      /* Settings UI Styles */
      .customized-label {
        color: var(--pico-primary);
        font-weight: bold;
      }

      .mode-card {
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.2s, transform 0.1s ease;
        margin-bottom: 0;
      }

      .mode-card:hover {
        border-color: var(--pico-muted-border-color);
        transform: scale(1.02);
      }

      .mode-card.active {
        border-color: var(--pico-primary);
      }

      /* Column List: Defaults to 1 column (mobile), switches to 2 on larger screens */
      .column-list {
        column-count: 1;
      }

      /* 
           RESPONSIVE CONTRIBUTIONS TABLE 
           Replaces standard table for better mobile display
        */
      .contributions-table {
        width: 100%;
        font-size: 0.9rem;
      }

      .contribution-row {
        display: grid;
        grid-template-columns: 1fr auto;
        grid-template-areas:
          "source score"
          "rank score";
        gap: 0.25rem 1rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--pico-muted-border-color);
      }

      .contributions-header {
        display: none; /* Hidden on mobile */
      }

      .col-source {
        grid-area: source;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        min-width: 0; /* Enables truncation if needed */
      }

      .col-source span {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .col-rank {
        grid-area: rank;
        font-family: var(--pico-font-family-monospace);
        color: var(--pico-muted-color);
        font-size: 0.85em;
      }

      .col-score {
        grid-area: score;
        display: flex;
        align-items: center;
        justify-content: flex-end;
      }

      /* Desktop/Tablet: Switch to Table-like Grid */
      @media (min-width: 1025px) {
        .contributions-header {
          display: grid;
          grid-template-columns: 1fr 100px 120px;
          padding: 0.5rem 1rem;
          gap: 1rem;
          font-weight: bold;
          border-bottom: 2px solid var(--pico-muted-border-color);
        }

        /* Center the rank header specifically */
        .contributions-header > div:nth-child(2) {
          text-align: center;
        }

        .contribution-row {
          grid-template-columns: 1fr 100px 120px;
          grid-template-areas: "source rank score";
          align-items: center;
          padding: 0.5rem 1rem;
          gap: 1rem;
          border-bottom: 1px solid var(--pico-table-border-color);
        }

        .col-rank {
          font-size: 1em;
          color: var(--pico-color);
          text-align: center; /* Center the rank numbers */
        }

        /* Striping */
        .contribution-row:nth-child(even) {
          background-color: var(--pico-table-row-stripped-background-color);
        }
      }

      /* Mobile Modal Fixes: Flatten nested structure to maximize width */
      @media (max-width: 1024px) {
        /* Remove extra padding from container inside dialog */
        dialog .container {
          padding-left: 0;
          padding-right: 0;
        }

        /* Remove card styling from nested articles to regain horizontal space */
        dialog article article {
          padding: 0;
          background: transparent;
          box-shadow: none;
          margin-bottom: 1.5rem;
          border-bottom: 1px solid var(--pico-muted-border-color);
          padding-bottom: 1.5rem;
        }

        dialog article article:last-of-type {
          border-bottom: none;
          margin-bottom: 0;
          padding-bottom: 0;
        }

        /* Tighten up the formula display in settings */
        math-formula svg {
          max-width: 100%;
        }
      }

      @media (min-width: 1025px) {
        .column-list {
          column-count: 2;
          column-gap: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <header class="container">
      <nav>
        <ul>
          <li><strong>Consensus Best Songs 2025</strong></li>
        </ul>
        <ul>
          <li><a href="#" id="open-settings">Settings</a></li>
          <li><a href="#" id="open-about">About</a></li>
        </ul>
      </nav>
    </header>

    <main class="container" id="app">
      <div id="song-list"></div>

      <div style="padding: 2rem 0; text-align: center">
        <button id="load-more" class="outline">Show More</button>
      </div>
    </main>

    <dialog id="modal-settings">
      <article>
        <header>
          <button aria-label="Close" rel="prev" class="close-modal"></button>
          <h3>Settings</h3>
        </header>
        <div id="settings-content"></div>
        <footer>
          <button class="secondary" id="reset-defaults">Defaults</button>
          <button class="close-modal">Close</button>
        </footer>
      </article>
    </dialog>

    <dialog id="modal-stats">
      <article>
        <header>
          <button aria-label="Close" rel="prev" class="close-modal"></button>
          <h3 id="stats-title">Ranking Stats</h3>
        </header>
        <div id="stats-content"></div>
      </article>
    </dialog>

    <dialog id="modal-reviews">
      <article>
        <header>
          <button aria-label="Close" rel="prev" class="close-modal"></button>
          <h3>Reviews</h3>
        </header>
        <div id="reviews-content"></div>
      </article>
    </dialog>

    <dialog id="modal-about">
      <article>
        <header>
          <button aria-label="Close" rel="prev" class="close-modal"></button>
          <h2>About</h2>
        </header>
        <main class="container">
          <article id="about-general">
            <hgroup>
              <h2>Behind the project</h2>
              <p>A labor of love for music and data</p>
            </hgroup>
            <p>
              I'm Everett. I love music, data, and technology. Each year, I look
              through the many
              <strong>"Best Songs of the Year"</strong> lists to find new music
              I might have missed. There are so many songs (<kbd id="total-songs-count">...</kbd> so far this year)! I often prioritize
              my listening order with a ranking. This site is a result of
              that obsession and an excuse to try using AI for frontend
              development.
            </p>
            <p>
              <a href="https://github.com/eandx1/consensus-best-songs-2025"
                >Read more about the analysis and process on GitHub</a
              >.
            </p>
          </article>

          <article id="about-methodology">
            <hgroup>
              <h2>How it works</h2>
              <p>Build your own 2025 definitive ranking</p>
            </hgroup>
            <p>
              This site aggregates <strong>"Best Songs of 2025"</strong> lists
              from US/UK music industry sites, critics, niche/genre sites, and
              the mainstream press.
              <strong
                >By default, the ranking prioritizes consensus and crossover
                hits, seasoned with a bit of my own genre and source
                biases.</strong
              >
            </p>
            <p>
              Make it your own!
              <ul>
                <li><strong>Weight sources</strong>: Boost your favorite publications</li>
                <li><strong>Choose a rank decay function</strong>: Prioritize #1 spots over general consensus</li>
                <li><strong>Boost song types</strong>: Prefer niche sounds over the mainstream</li>
              </ul>
            </p>
          </article>

          <article id="about-ranking">
            <hgroup>
              <h2>Ranking methodology</h2>
              <p>Key settings</p>
            </hgroup>
            <p>
              The algorithm uses a
              <strong>Weighted Decay Model</strong> to assign value to each critic's chosen rank. A #1 is worth more than a
              #10, but <em>how much more</em> depends on the formula and parameter used.
            </p>
            <div class="grid">
              <article class="about-methodology-box">
                <hgroup>
                  <h6>ü§ù Consensus Mode</h6>
                  <p>
                    <small
                      >Prioritizes the "Cultural Record" songs appearing on the
                      highest volume of lists rather than the differences
                      between a song being #1 versus #10 on different
                      ones.</small
                    >
                  </p>
                </hgroup>
              </article>
              <article class="about-methodology-box">
                <hgroup>
                  <h6>üî• Conviction Mode</h6>
                  <p>
                    <small
                      >Rewards critical obsession with a steep power law decay,
                      making a #1 worth dramatically more than a #10.</small
                    >
                  </p>
                </hgroup>
              </article>
            </div>
              
              <table id="mode-comparison-table">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Consensus</th>
                    <th>Conviction</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td colspan="3">Loading...</td></tr>
                </tbody>
              </table>
        </article>

            <article id="about-ui">
            <hgroup>
                <h2>Decoding the UI</h2>
              <p>Understanding the icons and abbreviations</p>
            </hgroup>
            <ul>
              <li>
                <strong>Categories</strong>: Indicators like üèõÔ∏è (Critical Authority) or üß™
                (Specialists) show which category or "cluster" of critics championed a track.
                You can give a boost to songs that were on lists from multiple
                categories.
              </li>
              <li>
                <strong>Shadow Ranks (üëª)</strong>: For unranked lists, I
                calculated a projected rank based on list length to ensure fair
                weighting. You can change these if you like.
              </li>
              <li>
                <strong>Other Boosts</strong>: You can add extra boosts for ‚ö°
                Provocation (critic disagreement or polarization) and ü§ù
                Consensus (the number of different reviews a song appeared in).
              </li>
            </ul>
          </article>
        </main>
      </article>
    </dialog>

    <script src="./script.js"></script>
  </body>
</html>
